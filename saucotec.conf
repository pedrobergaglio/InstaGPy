<VirtualHost *:443>
    ServerName saucotec.com
    ServerAlias www.saucotec.com

    ProxyPass /theringsmethod http://localhost:3001
    ProxyPassReverse /theringsmethod http://localhost:3001

    ProxyPass /energiaglobal http://localhost:8080
    ProxyPassReverse /energiaglobal http://localhost:8080

    ProxyPass /sms http://localhost:8000
    ProxyPassReverse /sms http://localhost:8000

    ProxyPass /ai-startup http://localhost:3008
    ProxyPassReverse /ai-startup http://localhost:3008

    # Message Generator Configuration
    <Location /message_generator>
        ProxyPass http://localhost:8501/message_generator
        ProxyPassReverse http://localhost:8501/message_generator
        
        # Required for Streamlit's WebSocket connections
        RewriteEngine On
        RewriteCond %{HTTP:Upgrade} websocket [NC]
        RewriteCond %{HTTP:Connection} upgrade [NC]
        RewriteRule ^/message_generator/(.*) "ws://localhost:8501/message_generator/$1" [P,L]
        
        RequestHeader set X-Forwarded-Proto "https"
        RequestHeader set Host "localhost:8501"
        RequestHeader set X-Real-IP %{REMOTE_ADDR}s
        RequestHeader set X-Forwarded-Path "/message_generator"
    </Location>

    # Other Apache configuration...
    <Location /energiaglobal/remito>
        ProxyPass http://localhost:5001/
        ProxyPassReverse http://localhost:5001/
    </Location>

    <Location /bergaglioabogados>
        ProxyPass http://localhost:8081/
        ProxyPassReverse http://localhost:8081/
    </Location>

    #every other request goes to
    ProxyPass /phpmyadmin http://localhost/phpmyadmin
    ProxyPassReverse /phpmyadmin http://localhost/phpmyadmin

    ProxyPass / http://localhost:3000/

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/saucotec.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/saucotec.com/privkey.pem
</VirtualHost>

<VirtualHost *:80>
    ServerName saucotec.com
    ServerAlias www.saucotec.com

    ProxyPass /theringsmethod http://localhost:3001
    ProxyPassReverse /theringsmethod http://localhost:3001

    ProxyPass /energiaglobal http://localhost:8080
    ProxyPassReverse /energiaglobal http://localhost:8080

    ProxyPass /sms http://localhost:8000
    ProxyPassReverse /sms http://localhost:8000

    ProxyPass /ai-startup http://localhost:3008
    ProxyPassReverse /ai-startup http://localhost:3008
    
    # Message Generator Configuration
    <Location /message_generator>
        ProxyPass http://localhost:8501/message_generator
        ProxyPassReverse http://localhost:8501/message_generator
        
        # Required for Streamlit's WebSocket connections
        RewriteEngine On
        RewriteCond %{HTTP:Upgrade} websocket [NC]
        RewriteCond %{HTTP:Connection} upgrade [NC]
        RewriteRule ^/message_generator/(.*) "ws://localhost:8501/message_generator/$1" [P,L]
        
        RequestHeader set X-Forwarded-Proto "http" 
        RequestHeader set Host "localhost:8501"
        RequestHeader set X-Real-IP %{REMOTE_ADDR}s
        RequestHeader set X-Forwarded-Path "/message_generator"
    </Location>

    # Other Apache configuration...
    <Location /energiaglobal/remito>
        ProxyPass http://localhost:5001/
        ProxyPassReverse http://localhost:5001/
    </Location>

    <Location /bergaglioabogados>
        ProxyPass http://localhost:8081/
        ProxyPassReverse http://localhost:8081/
    </Location>

    #every other request goes to
    ProxyPass /phpmyadmin http://localhost/phpmyadmin
    ProxyPassReverse /phpmyadmin http://localhost/phpmyadmin

    ProxyPass / http://localhost:3000/

    RewriteEngine on
    RewriteCond %{SERVER_NAME} =saucotec.com [OR]
    RewriteCond %{SERVER_NAME} =www.saucotec.com
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>
